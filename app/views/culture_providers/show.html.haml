- content_for(:page_title) do
  = @culture_provider.name

- content_for(:javascript) do
  = javascript_include_tag "tab_events"

%main
  #slideshow.header
    .map-container(style="display:none;")
    .images
      - @culture_provider.images_excluding_main.each do |image|
        = uploaded_image_tag image
    %menu
      %li.prev Föregående
      %li.next Nästa

  = render partial: "details", locals: { culture_provider: @culture_provider }

  %article.body-copy.description
    = show_description(@culture_provider.description)

    - unless @culture_provider.linked_culture_providers.empty? && @culture_provider.linked_events.empty?
      %section.box.related
        %h3.box-title Se även

        .box-content
          %ul
            - @culture_provider.linked_culture_providers.each do |link|
              %li= link_to link.name, link
            - @culture_provider.linked_events.each do |link|
              %li= link_to link.name, link

  - if user_online? && current_user.can_administrate?(@culture_provider)
    = render partial: "administration_menu", locals: { culture_provider: @culture_provider }

  %section.events
    .tabbable
      %ul.nav.nav-pills
        %li.active
          = link_to "Kommande evenemang", "#tab1", "data-toggle"=>"tab"
        %li
          = link_to "Löpande evenemang", "#tab2", "data-toggle"=>"tab"
        - if user_online? && current_user.can_administrate?(@culture_provider)
          %li
            = link_to "Alla evenemang", "#tab3", "data-toggle"=>"tab"
      .tab-content
        .tab-pane.active{id: "tab1"}
          .occasions
            %h3 Kommande evenemang
            - cache upcoming_occasions_cache_key(@culture_provider), skip_digest: true do
              - unless @culture_provider.upcoming_occasions.empty?
                = render partial: "calendar/occasions_list",
                  locals: { occasions: @culture_provider.upcoming_occasions,
                  hide_culture_provider: true }
        .tab-pane{id: "tab2"}
          .events
            %h3 Löpande evenemang
            - cache standing_events_cache_key(@culture_provider), skip_digest: true do
              - unless @culture_provider.standing_events.empty?
                %ul
                  - @culture_provider.standing_events.each do |event|
                    %li= link_to event.name, event
        - if user_online? && current_user.can_administrate?(@culture_provider)
          .all_events
            .tab-pane{id: "tab3"}
              %h3 Alla evenemang
        - cache all_events_cache_key(@culture_provider), skip_digest: true do
          - unless @culture_provider.events.empty?
            %ul
              - @culture_provider.events.order(created_at: :desc).each do |event|
                %li= link_to event.name, event
